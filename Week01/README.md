## 学习笔记

### 微服务
- 定义：
  - 围绕业务功能构建的，服务关注单一业务，服务间采用轻量级通信机制，可以全自动独立部署，可以使用不同的编程语言和数据存储技术
  - 微服务架构通过业务拆分实现服务组件化，通过组件组合快速开发系统，业务单一的服务组件又可以单独部署，使得整个系统变得清晰灵活
- 特点
  - 原子服务
  - 独立进程
  - 隔离部署
  - 去中心化服务治理
- 缺点
  - 基础设施的建设、复杂度高
- 是SOA架构模式的实践
- 微服务优点
  - 小。拆分成一个个的小的服务，代码少，易测试，易维护，更容易不断迭代完善的精致而美妙
  - 单一职责。一个服务只需要做一件事
  - 尽可能早的创建原型。尽可能早的提供服务API，建立服务契约，达成服务间沟通的一致性约定，至于实现和完善可以后面慢慢做
  - 可移植性比效率更重要。服务间的轻量级交互协议在效率和可移植性二者间，首要考虑兼容性和可移植性

- 微服务不足
  - 微服务应用是分布式系统，复杂性增加。不得不使用RPC或消息传递来实现进程间的通信。并且要通过代码来处理消息传递中的速度过慢或者服务不可用的局部失效问题
  - 分区数据库架构。同时更新多个业务主体的事务很普遍，这种事务对于单体应用很容易，更新一个数据库，在微服务应用中要更新不同服务的数据库，从而对开发者提出更高的要求和挑战
  - 测试微服务架构的应用也是很复杂的任务
  - 服务模块的依赖，应用的升级可能波及多个服务模块
  - 对于运维基础设施的挑战很大

- 实现
  - 组件服务化
    - 传统实现组件的方式是通过库（library），库和应用运行在进程中，库的局部变化意味着整个应用重新部署
    - 通过服务实现组件，应用拆分成一系列的服务运行在不同的进程中，单一服务的局部变化只需要更新对应的服务进程
      - 例如（本质上等同于，多个微服务compose组合完成一个完整的用户场景usecase）
        - kit：一个微服务的基础基础库
        - service：业务代码+kit依赖+第三方依赖组成的业务微服务
        - rpc+message queue：轻量级通信

  - 按业务组织服务（服务提供的能力和业务功能对应）

### API Gateway
- 特点
  - 轻量交互：协议精简聚合
  - 差异服务：数据裁剪以及聚合，针对终端定制化API
  - 动态升级：原有系统兼容升级，更新服务而非协议
  - 沟通效率提升，协作模式演进为移动业务+网关小组

### gRPC
- 定义
  - gRPC 是Google发起的一个开源远程过程调用系统
  - 该系统基于HTTP/2协议传输，使用Protocol Buffers作为接口描述语言

- 优点
  - 多语言支持
  - 轻量级、高性能
  - 可插拔
  - IDL：基于文件定义服务，通过proto3工具生成指定语言的数据结构、服务端接口以及客户端stub
  - 设计理念：例如源数据传递
  - 移动端：基于标准的HTTP2设计，支持双向流，http头压缩，单TCP的多路复用、服务端推送等特性，这些特性是的gRPC在移动端更加省电和节省网络流量
- 延伸PB（Protocol Buffers）
  - 一种序列化数据结构的协议  